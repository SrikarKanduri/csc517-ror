<p id="notice"><%= notice %></p>

<h1><%= @page_title %></h1>

<% if @filter %>
  <div>
    <% if @filter.status %>
      <span style="color: blue"><b>Status: </b><%= @filter.status %></span>
    <% end %>
    <% if !@filter.name.empty? %>
      <span style="color: darkorange"><b>Name: </b><%= @filter.name %></span>
    <% end %>
    <%if @filter.price %>
      <span style="color: blue"><b>Price: </b><%= @filter.price %></span>
    <%end %>
    <%if @filter.booking_deadline %>
      <span style="color: darkorange"><b>Booking Deadline: </b><%= @filter.booking_deadline %></span>
    <%end %>
    <%if @filter.from_date %>
      <span style="color: blue"><b>From Date: </b><%= @filter.from_date %></span>
    <%end %>
    <%if @filter.to_date %>
      <span style="color: darkorange"><b>To Date: </b><%= @filter.to_date %></span>
    <%end %>
  </div>
  <% if @filter.tour_locations %>
    <h4><b><u>Itinerary</u></b></h4>
    <% @filter.tour_locations.each do |itinerary| %>
      <ul>
        <span style="color: blue"><b>Country: </b><%= itinerary.country %></span>
        <span style="color: darkorange"><b>State/Province: </b><%= itinerary.state_or_province %></span>
      </ul>
      <ul>
      </ul>
    <% end %>
  <% end %>
  <br>
<% end %>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Price</th>
      <th>Booking deadline</th>
      <th>From date</th>
      <th>To date</th>
      <th>Total seats</th>
      <th>Operator email</th>
      <th>Operator phone</th>
      <th>Status</th>
      <% if %w[admin customer].include?(current_user.role) %>
        <th>My Booked Seats</th>
        <th>My Waitlisted Seats</th>
      <% end %>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @tours.each do |tour| %>
      <tr>
        <td><%= tour.name %></td>
        <td><%= tour.description %></td>
        <td><%= number_to_currency(tour.price) %></td>
        <td><%= tour.booking_deadline.to_s(:long) %></td>
        <td><%= tour.from_date.to_s(:long) %></td>
        <td><%= tour.to_date.to_s(:long) %></td>
        <td><%= tour.total_seats %></td>
        <td><%= tour.op_email %></td>
        <td><%= tour.op_phone %></td>
        <td><%= Tour.statuses[tour.status] %></td>
        <% if %w[admin customer].include?(current_user.role) %>
          <% ut = UserTour.get_user_tour(tour.id, current_user.id) %>
          <% if ut %>
            <td><%= ut[:num_booked] %></td>
            <td><%= ut[:num_wait_listed] %></td>
          <% else %>
            <td></td>
            <td></td>
          <% end %>
        <% end %>
        <td><%= link_to 'Show', tour %></td>
        <% if can? :manage, tour %>
          <td><%= link_to 'Edit', edit_tour_path(tour) %></td>
          <td><%= link_to 'Destroy', tour, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if %w[admin agent].include?(current_user.role) %>
  <%= link_to 'New Tour', new_tour_path %>
<% end %>

